#!/bin/bash

set -e
trap 'rm -f .env; exit' EXIT INT TERM

echo "ğŸ“¢ Sourcing env from /etc/quicksilvra/quicksilvra-env.sh"
source /etc/quicksilvra/quicksilvra-env.sh

cd /opt/deploy/%%servicename%%

IMAGE_TAR_UNCOMPRESSED="%%IMAGE_TAR_UNCOMPRESSED%%"

echo "ğŸ³ Loading Docker image..."
sudo docker load -i "$IMAGE_TAR_UNCOMPRESSED"

echo "ğŸ“ Creating .env file for Docker Compose..."
cat <<EOF > .env

EOF


echo "ğŸ›‘ Stopping existing %%servicename%% container..."
docker compose -f docker-compose.yaml stop %%servicename%%
docker compose -f docker-compose.yaml rm -f %%servicename%%

echo "ğŸš€ Starting new %%servicename%% container..."
docker compose -f docker-compose.yaml up -d %%servicename%%
